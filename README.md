# é‡‘èåˆ†æ Agent ç³»ç»Ÿ

<div align="center">

<img src="https://capsule-render.vercel.app/api?type=waving&color=gradient&customColorList=12,15,20,24&height=200&section=header&text=é‡‘èåˆ†ææ™ºèƒ½ä½“ç³»ç»Ÿ&fontSize=80&fontAlignY=35&desc=Aè‚¡è‚¡ç¥¨å…¨æ–¹ä½åˆ†æå¹³å°&descAlignY=60&animation=fadeIn" />

[![License](https://img.shields.io/badge/License-GPLv3-lightgrey.svg?style=flat-square&logo=gnu)](LICENSE)
[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg?style=flat-square&logo=python&logoColor=white)](https://www.python.org/downloads/)
[![LangGraph](https://img.shields.io/badge/LangGraph-0.2.56-green?style=flat-square)](https://github.com/langchain-ai/langgraph)
[![MCP Tools](https://img.shields.io/badge/MCP-Tools-E6162D?style=flat-square)](https://github.com/24mlight/a-share-mcp-is-just-i-need)

<img src="https://img.shields.io/badge/æ™ºèƒ½åˆ†æ-åŸºæœ¬é¢/æŠ€æœ¯é¢/ä¼°å€¼-E6162D?style=for-the-badge">

</div>

**âš ï¸ å…è´£å£°æ˜ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²ç›®çš„ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œäº¤æ˜“éœ€è°¨æ…ã€‚**

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## ğŸ” é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº LangGraph çš„é‡‘èåˆ†æ Agent ç³»ç»Ÿï¼Œç”¨äºåˆ†æ A è‚¡è‚¡ç¥¨ã€‚ç³»ç»ŸåŒ…å«å››ä¸ª Agentï¼šæŠ€æœ¯åˆ†æ Agentã€ä»·å€¼åˆ†æ Agentã€åŸºæœ¬é¢åˆ†æ Agent å’Œæ€»ç»“ Agentã€‚å‰ä¸‰ä¸ª Agent é€šè¿‡ MCP å·¥å…·è·å– A è‚¡ç›¸å…³æ•°æ®å¹¶ä¸å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’ï¼›æ€»ç»“ Agent ç»¼åˆä¸Šæ¸¸æ•°æ®ï¼Œæä¾›æœ€ç»ˆæŠ•èµ„å»ºè®®ã€‚

<div align="center">
<table>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/stocks-growth.png" width="30px"/><br><b>å¤šç»´åº¦åˆ†æ</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/line-chart.png" width="30px"/><br><b>æ•°æ®é©±åŠ¨</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/economic-improvement.png" width="30px"/><br><b>æ™ºèƒ½å†³ç­–</b></td>
  </tr>
  <tr>
    <td>ç³»ç»ŸåŒæ—¶ä»åŸºæœ¬é¢ã€æŠ€æœ¯é¢å’Œä¼°å€¼ä¸‰ä¸ªç»´åº¦è¿›è¡Œåˆ†æ</td>
    <td>åˆ©ç”¨å®æ—¶Aè‚¡æ•°æ®ï¼Œæä¾›æ•°æ®æ”¯æŒçš„å†³ç­–å»ºè®®</td>
    <td>AIæ™ºèƒ½æ±‡æ€»åˆ†æç»“æœï¼Œæä¾›æ¸…æ™°çš„æŠ•èµ„å»ºè®®</td>
  </tr>
</table>
</div>

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

<div align="center">
<table>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/group-of-projects.png" width="30px"/><br><b>å¤š Agent åä½œ</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/tools.png" width="30px"/><br><b>MCP å·¥å…·é›†æˆ</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/artificial-intelligence.png" width="30px"/><br><b>æ™ºèƒ½å·¥å…·é€‰æ‹©</b></td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/data-flow.png" width="30px"/><br><b>æ•°æ®æµä¼ é€’</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/financial-growth-analysis.png" width="30px"/><br><b>æŠ•èµ„å»ºè®®ç”Ÿæˆ</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/markdown.png" width="30px"/><br><b>Markdown æŠ¥å‘Š</b></td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/query.png" width="30px"/><br><b>è‡ªç„¶è¯­è¨€æŸ¥è¯¢</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/chat.png" width="30px"/><br><b>äº¤äº’å¼è¾“å…¥</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/update.png" width="30px"/><br><b>å®æ—¶æ•°æ®æ›´æ–°</b></td>
  </tr>
</table>
</div>

- **å¤š Agent åä½œ**ï¼šæŠ€æœ¯åˆ†æã€ä»·å€¼åˆ†æã€åŸºæœ¬é¢åˆ†æå’Œæ€»ç»“å››ä¸ª Agent ååŒå·¥ä½œ
- **MCP å·¥å…·é›†æˆ**ï¼šé€šè¿‡`langchain-mcp-adapters`åŠ è½½`a-share-mcp-v2`æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå·¥å…·
- **æ™ºèƒ½å·¥å…·é€‰æ‹©**ï¼šAgent æ ¹æ®èŒèƒ½è®¾è®¡çš„ Prompt æ™ºèƒ½é€‰æ‹©å·¥å…·ï¼Œå¤„ç†ä¸Šæ¸¸æ•°æ®å’Œ MCP æ•°æ®
- **æ•°æ®æµä¼ é€’**ï¼šä½¿ç”¨`AgentState`ä¼ é€’æ•°æ®å’Œå…ƒæ•°æ®ï¼Œç¡®ä¿ä¿¡æ¯æµç•…é€š
- **æŠ•èµ„å»ºè®®ç”Ÿæˆ**ï¼šæ€»ç»“ Agent ç»¼åˆä¸Šæ¸¸æ•°æ®ï¼Œæä¾› A è‚¡æŠ•èµ„å»ºè®®
- **Markdown æŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆæ ¼å¼åŒ–çš„ Markdown åˆ†ææŠ¥å‘Šå¹¶ä¿å­˜åˆ°æ–‡ä»¶
- **ğŸ†• è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ï¼šæ”¯æŒä»»æ„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œæ— éœ€ç‰¹å®šæ ¼å¼
- **ğŸ†• äº¤äº’å¼è¾“å…¥**ï¼šæœªæä¾›å‘½ä»¤å‚æ•°æ—¶è‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»ŸåŸºäº LangGraph æ¡†æ¶ï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

<div align="center">
<table>
  <tr>
    <th>ç»„ä»¶</th>
    <th>æè¿°</th>
  </tr>
  <tr>
    <td><b>AgentState</b></td>
    <td>è‡ªå®šä¹‰çš„ TypedDictï¼Œç”¨äºåœ¨ Agent ä¹‹é—´ä¼ é€’æ•°æ®</td>
  </tr>
  <tr>
    <td><b>Agent</b></td>
    <td>å››ä¸ªä¸“ä¸š Agentï¼Œå„å¸å…¶èŒ</td>
  </tr>
  <tr>
    <td><b>MCP å·¥å…·</b></td>
    <td>é€šè¿‡ MultiServerMCPClient åŠ è½½ a-share-mcp-v2 æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå·¥å…·</td>
  </tr>
  <tr>
    <td><b>LLM äº¤äº’</b></td>
    <td>æ¯ä¸ª Agent ä½¿ç”¨ç»‘å®šçš„ ChatOpenAI æ¨¡å‹ä¸ LLM äº¤äº’</td>
  </tr>
  <tr>
    <td><b>å·¥ä½œæµ</b></td>
    <td>ä½¿ç”¨ StateGraph å®šä¹‰ Agent æ‰§è¡Œé¡ºåº</td>
  </tr>
</table>
</div>

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ç¯å¢ƒè®¾ç½®

<div align="center">
<table>
  <tr>
    <th>æ­¥éª¤</th>
    <th>å‘½ä»¤/æ“ä½œ</th>
  </tr>
  <tr>
    <td><b>1. å®‰è£…ä¾èµ–</b></td>
    <td>
      
```bash
poetry install
```

```bash
cp .env.example .env
```

    </td>

  </tr>
  <tr>
    <td><b>2. é…ç½®ç¯å¢ƒå˜é‡</b></td>
    <td>
      
```
OPENAI_COMPATIBLE_API_KEY=your_api_key
OPENAI_COMPATIBLE_BASE_URL=your_base_url
OPENAI_COMPATIBLE_MODEL=your_model
```
    </td>
  </tr>
  <tr>
    <td><b>3. é…ç½® MCP æœåŠ¡å™¨</b></td>
    <td>ç¼–è¾‘ <code>src/tools/mcp_config.py</code> æ–‡ä»¶</td>
  </tr>
</table>
</div>

1. å®‰è£…ä¾èµ–ï¼š

   ```bash
   poetry install
   ```

   ```bash
   cp .env.example .env
   ```

æˆ–è€…æ‰‹åŠ¨å°† `.env.example` æ–‡ä»¶æ”¹åä¸º `.env`

2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env æ–‡ä»¶ï¼‰ï¼š

```
OPENAI_COMPATIBLE_API_KEY=your_api_key
OPENAI_COMPATIBLE_BASE_URL=your_base_url
OPENAI_COMPATIBLE_MODEL=your_model
```

3. é…ç½® MCP æœåŠ¡å™¨ï¼š

   ç¼–è¾‘ `src/tools/mcp_config.py` æ–‡ä»¶ï¼Œä¿®æ”¹ MCP æœåŠ¡å™¨è·¯å¾„ï¼š

   ```python
   SERVER_CONFIGS = {
       "a_share_mcp_v2": {  # é‡å‘½åä»¥æé«˜æ¸…æ™°åº¦ï¼ŒåŸåä¸º "a-share-mcp-v2"
           "command": "uv",  # å‡è®¾'uv'åœ¨PATHä¸­æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„
           "args": [
               "run",  # uv runå‘½ä»¤
               "--directory",
               r"a_share_mcpé¡¹ç›®çš„ç»å¯¹è·¯å¾„",  # ä¿®æ”¹ä¸ºæ‚¨å·²éƒ¨ç½²å¥½çš„MCPæœåŠ¡å™¨é¡¹ç›®è·¯å¾„ï¼Œå¦‚æœªéƒ¨ç½²å¥½ï¼Œè¯·git clone https://github.com/24mlight/a-share-mcp-is-just-i-need.gitï¼Œ ç„¶åéƒ¨ç½²
               "python",  # åœ¨uvä¸­è¿è¡Œçš„å‘½ä»¤
               "mcp_server.py"  # MCPæœåŠ¡å™¨è„šæœ¬
           ],
           "transport": "stdio",
       }
   }
   ```

   ç³»ç»Ÿé€šè¿‡æ­¤é…ç½®è¿æ¥åˆ° A è‚¡ MCP æœåŠ¡å™¨è·å–å®æ—¶é‡‘èæ•°æ®ã€‚

### è¿è¡Œåˆ†æ

<div align="center">
<table>
  <tr>
    <th colspan="2"><b>è¿è¡Œæ–¹å¼</b></th>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/console.png" width="30px"/><br><b>å‘½ä»¤è¡Œå‚æ•°æ¨¡å¼</b></td>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/chat.png" width="30px"/><br><b>äº¤äº’å¼æ¨¡å¼</b></td>
  </tr>
</table>
</div>

#### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå‚æ•°æ¨¡å¼

é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œï¼š

```bash
poetry run python -m src.main --command "åˆ†æè‚¡ç¥¨åç§°"
```

ä¾‹å¦‚ï¼š

```bash
poetry run python -m src.main --command "åˆ†æè´µå·èŒ…å°"
poetry run python -m src.main --command "å¸®æˆ‘çœ‹çœ‹æ¯”äºšè¿ªè¿™åªè‚¡ç¥¨æ€ä¹ˆæ ·"
poetry run python -m src.main --command "æˆ‘æƒ³äº†è§£ä¸€ä¸‹è…¾è®¯çš„æŠ•èµ„ä»·å€¼"
```

#### æ–¹å¼äºŒï¼šäº¤äº’å¼æ¨¡å¼ ğŸ†•

ç›´æ¥è¿è¡Œç¨‹åºï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼š

```bash
poetry run python -m src.main
```

ç³»ç»Ÿä¼šæ˜¾ç¤ºçš„æ¬¢è¿ç•Œé¢å’Œä½¿ç”¨æŒ‡å—ï¼Œç„¶åç­‰å¾…æ‚¨è¾“å…¥æŸ¥è¯¢ã€‚

**æ”¯æŒçš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ç¤ºä¾‹ï¼š**

- "åˆ†æå˜‰å‹å›½é™…"
- "å¸®æˆ‘çœ‹çœ‹æ¯”äºšè¿ªè¿™åªè‚¡ç¥¨æ€ä¹ˆæ ·"
- "æˆ‘æƒ³äº†è§£ä¸€ä¸‹è…¾è®¯çš„æŠ•èµ„ä»·å€¼"
- "603871 è¿™ä¸ªè‚¡ç¥¨å€¼å¾—ä¹°å—ï¼Ÿ"
- "ç»™æˆ‘åˆ†æä¸€ä¸‹å®å¾·æ—¶ä»£çš„è´¢åŠ¡çŠ¶å†µ"
- "ä¸­å›½å¹³å®‰ç°åœ¨çš„ä¼°å€¼å¦‚ä½•ï¼Ÿ"

> **æ³¨æ„**: å¿…é¡»ä½¿ç”¨ `python -m src.main` çš„æ¨¡å—å¯¼å…¥æ–¹å¼è¿è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥è¿è¡Œ `python src/main.py`ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ­£ç¡®çš„å¯¼å…¥è·¯å¾„ã€‚

### è¾“å‡º

ç³»ç»Ÿå°†åœ¨ç»ˆç«¯æ˜¾ç¤ºåˆ†æç»“æœï¼Œå¹¶å°†å®Œæ•´çš„ Markdown æ ¼å¼æŠ¥å‘Šä¿å­˜åˆ°`reports`ç›®å½•ã€‚

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## ğŸ“ æŠ¥å‘Šç¤ºä¾‹

<div align="center">
<table>
  <tr>
    <th>æŠ¥å‘Šç« èŠ‚</th>
    <th>å†…å®¹æè¿°</th>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/resume.png" width="25px"/> <b>æ‰§è¡Œæ‘˜è¦</b></td>
    <td>å¯¹åˆ†æç»“æœçš„æ•´ä½“æ¦‚è¿°å’Œå…³é”®ç»“è®º</td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/company.png" width="25px"/> <b>åŸºæœ¬é¢åˆ†æ</b></td>
    <td>å…¬å¸è´¢åŠ¡çŠ¶å†µã€ç»è¥æƒ…å†µå’Œè¡Œä¸šåœ°ä½åˆ†æ</td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/stocks-growth.png" width="25px"/> <b>æŠ€æœ¯åˆ†æ</b></td>
    <td>è‚¡ä»·èµ°åŠ¿ã€äº¤æ˜“é‡å’ŒæŠ€æœ¯æŒ‡æ ‡åˆ†æ</td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/money-bag.png" width="25px"/> <b>ä¼°å€¼åˆ†æ</b></td>
    <td>å¸‚ç›ˆç‡ã€å¸‚å‡€ç‡ç­‰ä¼°å€¼æŒ‡æ ‡åˆ†æ</td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/check-all.png" width="25px"/> <b>äº¤å‰éªŒè¯</b></td>
    <td>ä¸åŒåˆ†ææ–¹æ³•çš„å¯¹æ¯”éªŒè¯</td>
  </tr>
  <tr>
    <td align="center"><img src="https://img.icons8.com/fluency/48/null/idea.png" width="25px"/> <b>æŠ•èµ„å»ºè®®</b></td>
    <td>åŸºäºç»¼åˆåˆ†æçš„æŠ•èµ„å†³ç­–å»ºè®®</td>
  </tr>
</table>
</div>

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## ğŸ“ é¡¹ç›®ç»“æ„

```
Financial-MCP-Agent/
â”œâ”€â”€ .venv/            # è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ logs/             # æ‰§è¡Œæ—¥å¿—
â”œâ”€â”€ reports/          # ç”Ÿæˆçš„åˆ†ææŠ¥å‘Š
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/       # Agentå®ç°
â”‚   â”‚   â”œâ”€â”€ fundamental_agent.py  # åŸºæœ¬é¢åˆ†ææ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ technical_agent.py    # æŠ€æœ¯é¢åˆ†ææ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ value_agent.py        # ä¼°å€¼åˆ†ææ™ºèƒ½ä½“
â”‚   â”‚   â””â”€â”€ summary_agent.py      # æ€»ç»“æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ tools/        # å·¥å…·å®ç°
â”‚   â”‚   â”œâ”€â”€ mcp_client.py        # MCPå®¢æˆ·ç«¯å®ç°
â”‚   â”‚   â”œâ”€â”€ mcp_config.py        # MCPæœåŠ¡å™¨é…ç½®
â”‚   â”‚   â””â”€â”€ openrouter_config.py # OpenRouteré…ç½®
â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ execution_logger.py  # æ‰§è¡Œæ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ log_viewer.py        # æ—¥å¿—æŸ¥çœ‹å™¨
â”‚   â”‚   â”œâ”€â”€ logging_config.py    # æ—¥å¿—é…ç½®
â”‚   â”‚   â”œâ”€â”€ llm_clients.py       # LLMå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ state_definition.py  # çŠ¶æ€å®šä¹‰
â”‚   â””â”€â”€ main.py       # ä¸»ç¨‹åº
â”œâ”€â”€ tests/            # æµ‹è¯•
â”œâ”€â”€ .env              # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore        # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ logging_system.md # æ—¥å¿—ç³»ç»Ÿè¯´æ˜
â”œâ”€â”€ poetry.lock       # Poetryä¾èµ–é”å®š
â”œâ”€â”€ pyproject.toml    # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md         # é¡¹ç›®è¯´æ˜
â””â”€â”€ test_agent_with_real_tools.py # æµ‹è¯•è„šæœ¬
```

<div align="center">
<img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png" width="100%">
</div>

## âš ï¸ å…³äº terminal æ‰“å°çš„ä¿¡æ¯

```bash
Exception ignored in: <function BaseSubprocessTransport.__del__ at 0x00000217922E20C0>
Traceback (most recent call last):
  File "D:\python3.11\Lib\asyncio\base_subprocess.py", line 126, in __del__
    self.close()
  File "D:\python3.11\Lib\asyncio\base_subprocess.py", line 104, in close
    proto.pipe.close()
  File "D:\python3.11\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "D:\python3.11\Lib\asyncio\base_events.py", line 761, in call_soon
    self._check_closed()
  File "D:\python3.11\Lib\asyncio\base_events.py", line 519, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
```

ä¸Šè¿° error å¯ä»¥å¿½ç•¥ï¼Œè¿™æ˜¯ç”±äºå¼‚æ­¥æ‰§è¡Œæœªèƒ½æ­£ç¡®å…³é—­ã€‚ä¸å½±å“ç³»ç»Ÿè¿è¡Œï¼Œå¯ä»¥å¿½è§†ã€‚

<div align="center">
<img src="https://capsule-render.vercel.app/api?type=waving&color=gradient&customColorList=12,15,20,24&section=footer&height=100&animation=fadeIn" />
</div>
