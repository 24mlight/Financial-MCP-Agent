# é‡‘èåˆ†æ Agent ç³»ç»Ÿ

```
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚  ğŸ¦ é‡‘èåˆ†ææ™ºèƒ½ä½“ç³»ç»Ÿ | Financial Analysis AI Agents   â”‚
 â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
 â”‚  ğŸ“Š åŸºæœ¬é¢ â€¢ æŠ€æœ¯é¢ â€¢ ä¼°å€¼åˆ†æ â€¢ æ™ºèƒ½æ€»ç»“               â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

è¿™æ˜¯ä¸€ä¸ªåŸºäº LangGraph çš„é‡‘èåˆ†æ Agent ç³»ç»Ÿï¼Œç”¨äºåˆ†æ A è‚¡è‚¡ç¥¨ã€‚ç³»ç»ŸåŒ…å«å››ä¸ª Agentï¼šæŠ€æœ¯åˆ†æ Agentã€ä»·å€¼åˆ†æ Agentã€åŸºæœ¬é¢åˆ†æ Agent å’Œæ€»ç»“ Agentã€‚å‰ä¸‰ä¸ª Agent é€šè¿‡ MCP å·¥å…·è·å– A è‚¡ç›¸å…³æ•°æ®å¹¶ä¸å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’ï¼›æ€»ç»“ Agent ç»¼åˆä¸Šæ¸¸æ•°æ®ï¼Œæä¾›æœ€ç»ˆæŠ•èµ„å»ºè®®ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- **å¤š Agent åä½œ**ï¼šæŠ€æœ¯åˆ†æã€ä»·å€¼åˆ†æã€åŸºæœ¬é¢åˆ†æå’Œæ€»ç»“å››ä¸ª Agent ååŒå·¥ä½œ
- **MCP å·¥å…·é›†æˆ**ï¼šé€šè¿‡`langchain-mcp-adapters`åŠ è½½`a-share-mcp-v2`æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå·¥å…·
- **æ™ºèƒ½å·¥å…·é€‰æ‹©**ï¼šAgent æ ¹æ®èŒèƒ½è®¾è®¡çš„ Prompt æ™ºèƒ½é€‰æ‹©å·¥å…·ï¼Œå¤„ç†ä¸Šæ¸¸æ•°æ®å’Œ MCP æ•°æ®
- **æ•°æ®æµä¼ é€’**ï¼šä½¿ç”¨`AgentState`ä¼ é€’æ•°æ®å’Œå…ƒæ•°æ®ï¼Œç¡®ä¿ä¿¡æ¯æµç•…é€š
- **æŠ•èµ„å»ºè®®ç”Ÿæˆ**ï¼šæ€»ç»“ Agent ç»¼åˆä¸Šæ¸¸æ•°æ®ï¼Œæä¾› A è‚¡æŠ•èµ„å»ºè®®
- **Markdown æŠ¥å‘Š**ï¼šè‡ªåŠ¨ç”Ÿæˆæ ¼å¼åŒ–çš„ Markdown åˆ†ææŠ¥å‘Šå¹¶ä¿å­˜åˆ°æ–‡ä»¶
- **ğŸ†• è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ï¼šæ”¯æŒä»»æ„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œæ— éœ€ç‰¹å®šæ ¼å¼
- **ğŸ†• äº¤äº’å¼è¾“å…¥**ï¼šæœªæä¾›å‘½ä»¤å‚æ•°æ—¶è‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼

## ç³»ç»Ÿæ¶æ„

ç³»ç»ŸåŸºäº LangGraph æ¡†æ¶ï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

1. **AgentState**ï¼šè‡ªå®šä¹‰çš„ TypedDictï¼Œç”¨äºåœ¨ Agent ä¹‹é—´ä¼ é€’æ•°æ®
2. **Agent**ï¼šå››ä¸ªä¸“ä¸š Agentï¼Œå„å¸å…¶èŒ
3. **MCP å·¥å…·**ï¼šé€šè¿‡ MultiServerMCPClient åŠ è½½ a-share-mcp-v2 æœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå·¥å…·
4. **LLM äº¤äº’**ï¼šæ¯ä¸ª Agent ä½¿ç”¨ç»‘å®šçš„ ChatOpenAI æ¨¡å‹ä¸ LLM äº¤äº’
5. **å·¥ä½œæµ**ï¼šä½¿ç”¨ AsyncStateGraph å®šä¹‰ Agent æ‰§è¡Œé¡ºåº

## ä½¿ç”¨æ–¹æ³•

### ç¯å¢ƒè®¾ç½®

1. å®‰è£…ä¾èµ–ï¼š

   ```
   poetry install
   ```

2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env æ–‡ä»¶ï¼‰ï¼š

   ```
   OPENAI_COMPATIBLE_API_KEY=your_api_key
   OPENAI_COMPATIBLE_BASE_URL=your_base_url
   OPENAI_COMPATIBLE_MODEL=your_model
   ```

3. é…ç½® MCP æœåŠ¡å™¨ï¼š

   ç¼–è¾‘ `src/tools/mcp_config.py` æ–‡ä»¶ï¼Œä¿®æ”¹ MCP æœåŠ¡å™¨è·¯å¾„ï¼š

   ```python
   SERVER_CONFIGS = {
       "a_share_mcp_v2": {  # é‡å‘½åä»¥æé«˜æ¸…æ™°åº¦ï¼ŒåŸåä¸º "a-share-mcp-v2"
           "command": "uv",  # å‡è®¾'uv'åœ¨PATHä¸­æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„
           "args": [
               "run",  # uv runå‘½ä»¤
               "--directory",
               r"è·¯å¾„/åˆ°/a_share_mcp",  # ä¿®æ”¹ä¸ºæ‚¨çš„MCPæœåŠ¡å™¨é¡¹ç›®è·¯å¾„
               "python",  # åœ¨uvä¸­è¿è¡Œçš„å‘½ä»¤
               "mcp_server.py"  # MCPæœåŠ¡å™¨è„šæœ¬
           ],
           "transport": "stdio",
       }
   }
   ```

   ç³»ç»Ÿé€šè¿‡æ­¤é…ç½®è¿æ¥åˆ° A è‚¡ MCP æœåŠ¡å™¨è·å–å®æ—¶é‡‘èæ•°æ®ã€‚

### è¿è¡Œåˆ†æ

#### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå‚æ•°æ¨¡å¼

é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œï¼š

```
poetry run python -m src.main --command "åˆ†æè‚¡ç¥¨åç§°"
```

ä¾‹å¦‚ï¼š

```
poetry run python -m src.main --command "åˆ†æè´µå·èŒ…å°"
poetry run python -m src.main --command "å¸®æˆ‘çœ‹çœ‹æ¯”äºšè¿ªè¿™åªè‚¡ç¥¨æ€ä¹ˆæ ·"
poetry run python -m src.main --command "æˆ‘æƒ³äº†è§£ä¸€ä¸‹è…¾è®¯çš„æŠ•èµ„ä»·å€¼"
```

#### æ–¹å¼äºŒï¼šäº¤äº’å¼æ¨¡å¼ ğŸ†•

ç›´æ¥è¿è¡Œç¨‹åºï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¿›å…¥äº¤äº’æ¨¡å¼ï¼š

```
poetry run python -m src.main
```

ç³»ç»Ÿä¼šæ˜¾ç¤ºä¼˜ç¾çš„æ¬¢è¿ç•Œé¢å’Œä½¿ç”¨æŒ‡å—ï¼Œç„¶åç­‰å¾…æ‚¨è¾“å…¥æŸ¥è¯¢ã€‚

**æ”¯æŒçš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ç¤ºä¾‹ï¼š**

- "åˆ†æå˜‰å‹å›½é™…"
- "å¸®æˆ‘çœ‹çœ‹æ¯”äºšè¿ªè¿™åªè‚¡ç¥¨æ€ä¹ˆæ ·"
- "æˆ‘æƒ³äº†è§£ä¸€ä¸‹è…¾è®¯çš„æŠ•èµ„ä»·å€¼"
- "603871 è¿™ä¸ªè‚¡ç¥¨å€¼å¾—ä¹°å—ï¼Ÿ"
- "ç»™æˆ‘åˆ†æä¸€ä¸‹å®å¾·æ—¶ä»£çš„è´¢åŠ¡çŠ¶å†µ"
- "ä¸­å›½å¹³å®‰ç°åœ¨çš„ä¼°å€¼å¦‚ä½•ï¼Ÿ"

> **æ³¨æ„**: å¿…é¡»ä½¿ç”¨ `python -m src.main` çš„æ¨¡å—å¯¼å…¥æ–¹å¼è¿è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥è¿è¡Œ `python src/main.py`ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ­£ç¡®çš„å¯¼å…¥è·¯å¾„ã€‚

### è¾“å‡º

ç³»ç»Ÿå°†åœ¨ç»ˆç«¯æ˜¾ç¤ºåˆ†æç»“æœï¼Œå¹¶å°†å®Œæ•´çš„ Markdown æ ¼å¼æŠ¥å‘Šä¿å­˜åˆ°`reports`ç›®å½•ã€‚

## æŠ¥å‘Šç¤ºä¾‹

æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

- æ‰§è¡Œæ‘˜è¦
- åŸºæœ¬é¢åˆ†æ
- æŠ€æœ¯åˆ†æ
- ä¼°å€¼åˆ†æ
- äº¤å‰éªŒè¯
- æŠ•èµ„å»ºè®®

## é¡¹ç›®ç»“æ„

```
financial_agent/
â”œâ”€â”€ docs/             # æ–‡æ¡£
â”œâ”€â”€ reports/          # ç”Ÿæˆçš„åˆ†ææŠ¥å‘Š
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/       # Agentå®ç°
â”‚   â”‚   â”œâ”€â”€ fundamental_agent.py
â”‚   â”‚   â”œâ”€â”€ technical_agent.py
â”‚   â”‚   â”œâ”€â”€ value_agent.py
â”‚   â”‚   â””â”€â”€ summary_agent.py
â”‚   â”œâ”€â”€ tools/        # å·¥å…·å®ç°
â”‚   â”‚   â”œâ”€â”€ mcp_client.py
â”‚   â”‚   â”œâ”€â”€ mcp_config.py
â”‚   â”‚   â””â”€â”€ openrouter_config.py
â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logging_config.py
â”‚   â”‚   â””â”€â”€ state_definition.py
â”‚   â””â”€â”€ main.py       # ä¸»ç¨‹åº
â”œâ”€â”€ tests/            # æµ‹è¯•
â”œâ”€â”€ tutorial/         # æ•™å­¦æ–‡æ¡£
â”œâ”€â”€ .env              # ç¯å¢ƒå˜é‡
â””â”€â”€ README.md         # è¯´æ˜æ–‡æ¡£
```
## å…³äºterminalæ‰“å°çš„ä¿¡æ¯
```bash
Exception ignored in: <function BaseSubprocessTransport.__del__ at 0x00000217922E20C0>
Traceback (most recent call last):
  File "D:\python3.11\Lib\asyncio\base_subprocess.py", line 126, in __del__
    self.close()
  File "D:\python3.11\Lib\asyncio\base_subprocess.py", line 104, in close
    proto.pipe.close()
  File "D:\python3.11\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
  File "D:\python3.11\Lib\asyncio\base_events.py", line 761, in call_soon
    self._check_closed()
  File "D:\python3.11\Lib\asyncio\base_events.py", line 519, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
```
ä¸Šè¿°errorå¯ä»¥å¿½ç•¥ï¼Œè¿™æ˜¯ç”±äºå¼‚æ­¥æ‰§è¡Œæœªèƒ½æ­£ç¡®å…³é—­ã€‚ä¸å½±å“ç³»ç»Ÿè¿è¡Œï¼Œå¯ä»¥å¿½è§†ã€‚